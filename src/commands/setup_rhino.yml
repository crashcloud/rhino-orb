description: This command downloads and installs Rhino
parameters:
  version:
    type: string
    default: "7"
    description: "Which version of rhino should be installed, 6, 7 or 8"
  fullversion:
    type: string
    default: "latest"
    description: "What is the exact version of rhino that should be installed?"
  culture:
    type: string
    default: "en-us"
    description: "What is the exact culture for Rhino that should be installed?"
steps:

  - run:
      name: Clone Setup
      command: git clone https://github.com/crashcloud/rhino-setup.git

  - restore_cache:
      keys:
        - rhino-<<parameters.version>>-<<parameters.fullversion>>

  - run:
      name: Is Cache Related
      command: $ENV:FOUND_CACHE = (ls *.exe).Count -gt 0
      environment:
          FOUND_CACHE: postgres://conductor:@localhost:5432/conductor_test

  - save_cache:
      key: rhino-<<parameters.version>>-<<parameters.fullversion>>
      paths:
        - Rhino*.exe
    
  - run: 
      name: Install Wget
      command: pip install wget

  - run:
      name: Download Rhino
      environment:
        PARAM_VERSION: <<parameters.version>>
        PARAM_FULLVERSION: <<parameters.fullversion>>
        PARAM_CULTURE: <<parameters.culture>>
      command: <<include(scripts/download.ps1)>>

  - save_cache:
      key: rhino-<<parameters.version>>-<<parameters.fullversion>
      paths:
        - Rhino*.exe

  - run:
      name: show download
      command: ls *.exe

  - run:
      name: Setup Rhino
      command: <<include(scripts/install.ps1)>>

  - run:
      name: Install Check
      command: ls 'C:\Program Files\Rhino 7\System\*.exe'

  - run:
      name: Remove Downloads
      command: Remove-Item *.exe
